angular.module("JSFight",["ui.router","btford.socket-io"]).constant("API",{url:"http://localhost:3000/api/"}).run(["$rootScope","$state","$stateParams","$location",function(a,b,c){a.$state=b,a.$stateParams=c,a.$on("$stateChangeStart",function(b,c,d,e,f){a.user=JSON.parse(localStorage.getItem("user"))})}]),angular.module("JSFight").directive("keypressEvents",["$document","$rootScope",function(a,b){return{restrict:"A",link:function(){console.log("linked"),a.bind("keypress",function(a){b.$broadcast("keypress",a,String.fromCharCode(a.which))})}}}]),angular.module("JSFight").value("Formatter",function(a,b){return a+" - "+b+"\n"}),angular.module("JSFight").controller("AuthCtrl",["$scope","$state","$rootScope","Auth",function(a,b,c,d){a.login=function(){d.login(a.form.username,a.form.password).success(function(a){localStorage.setItem("user",JSON.stringify(a)),c.$broadcast("login",a),b.transitionTo("home")})},a.signup=function(){d.signup(a.form.username,a.form.password).success(function(a){localStorage.set("user",JSON.stringify(a)),c.$broadcast("login",a),b.transitionTo("home")})}}]),angular.module("JSFight").controller("ChatCtrl",["$scope","$http","$log","Chat","API","Formatter",function(a,b,c,d,e,f){a.user=JSON.parse(localStorage.getItem("user")).user,a.messageLog="Ready to chat!",a.load=function(){b.get(e.url+"/messages").success(function(b){b.forEach(function(b){a.messageLog=f(b.sender,b.content)+a.messageLog})})},a.sendMessage=function(){d.emit("message",a.user.local.username,a.message),a.message=""},a.$on("socket:broadcast",function(b,c){a.$apply(function(){a.messageLog=f(c.sender,c.content)+a.messageLog})}),a.load()}]),angular.module("JSFight").controller("HomeCtrl",["$scope","$state","$rootScope","Auth",function(a,b,c,d){a.user=JSON.parse(localStorage.getItem("user")).user,c.$on("login",function(b){a.user=b}),c.$on("logout",function(){a.user=null}),a.logout=function(){d.logout().success(function(a){localStorage.removeItem("user"),c.$broadcast("logout"),b.transitionTo("home")})}}]),angular.module("JSFight").controller("fighterCtrl",["$scope","$rootScope","Fight",function(a,b,c){a.player={name:"Mehdi",life:100,posX:0,posY:0,image:0},b.$on("keypress",function(b,c,d){a.$apply(function(){a.key=d})}),a.sendPlayer=function(){}}]),angular.module("JSFight").config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"../views/home.html",controller:"HomeCtrl"}).state("login",{url:"/login",templateUrl:"../views/auth/login.html",controller:"AuthCtrl"}).state("signup",{url:"/signup",templateUrl:"../views/auth/signup.html",controller:"AuthCtrl"}).state("game",{url:"/game",templateUrl:"../views/core_game/core_game_client.html",controller:"fighterCtrl"})}]),angular.module("JSFight").factory("Auth",["$http","API",function(a,b){return{signup:function(c,d){return a.post(b.url+"signup",{username:c,password:d})},login:function(c,d){return a.post(b.url+"login",{username:c,password:d})},logout:function(){return a.get(b.url+"logout")}}}]),angular.module("JSFight").factory("Chat",["socketFactory",function(a){var b=a();return b.forward("broadcast"),b}]),angular.module("JSFight").factory("Fight",["$http","API",function(a,b){return{}}]);