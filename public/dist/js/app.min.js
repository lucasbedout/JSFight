angular.module("JSFight",["ui.router"]).constant("API",{url:"http://localhost:3000/api/"}).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("home",{url:"/",templateUrl:"../views/home.html"}).state("login",{url:"/login",templateUrl:"../views/auth/login.html",controller:"AuthCtrl"}).state("signup",{url:"/signup",templateUrl:"../views/auth/signup.html",controller:"AuthCtrl"})}]),angular.module("JSFight").controller("AuthCtrl",["$scope","$state","$rootScope","Auth",function(a,b,c,d){a.login=function(){d.login(a.form.username,a.form.password).success(function(a){localStorage.setItem("user",JSON.stringify(a)),c.$broadcast("login",a),b.transitionTo("home")})},a.signup=function(){d.signup(a.form.username,a.form.password).success(function(a){localStorage.set("user",JSON.stringify(a)),c.$broadcast("login",a),b.transitionTo("home")})}}]),angular.module("JSFight").controller("HomeCtrl",["$scope","$state","$rootScope","Auth",function(a,b,c,d){c.$on("login",function(b){a.user=b}),c.$on("logout",function(){a.user=null}),a.logout=function(){d.logout().success(function(a){localStorage.removeItem("user"),c.$broadcast("logout"),b.transitionTo("home")})}}]),angular.module("JSFight").controller("LetsFight",["$scope","$state","$rootScope","Auth",function(a,b,c,d){var e=new SVGLib(document.getElementById("wannaFight"));a.player="player1",a.opponent="player2",a.player1=new Player(e,"default",60,60,a),a.player2=new Player(e,"default",160,60,a),a[a.player].movingLeft=!1,a[a.player].movingRight=!1,a[a.player].movingTop=!1,a[a.player].movingBot=!1,a[a.player].crouched=!1,a[a.player].attacking=!1,a[a.player].direciton=-1,a[a.player].jumping=0,document.addEventListener("keydown",function(b){37==b.keyCode&&(a[a.player].movingLeft=!0),65==b.keyCode&&(a[a.player].direction||(a[a.player].attacking=!0,a[a.player].punch(20,a,a[a.player].direction))),90==b.keyCode&&(a[a.player].attacking||(a[a.player].attacking=!0,a[a.player].punch(50,a,a[a.player].direction))),69==b.keyCode&&(a[a.player].attacking||(a[a.player].attacking=!0,a[a.player].punch(100,a,a[a.player].direction))),39==b.keyCode&&(a[a.player].movingRight=!0),32!=b.keyCode||a[a.player].crouched||(1===a[a.player].jumping?a[a.player].jump(60,a,a[a.player].stopJump()):0===a[a.player].jumping&&a[a.player].jump(60,a,a[a.player].getY())),40==b.keyCode&&(a[a.player].crouched||a[a.player].jumping||a[a.player].crouch(30,a))}),setInterval(function(){a[a.player].movingLeft&&a[a.player].moveLeft(),a[a.player].movingRight&&a[a.player].moveRight(),a[a.player].x-a[a.opponent].x?(a[a.player].direction=-1,a[a.opponent].direction=1):(a[a.player].direction=1,a[a.opponent].direction=-1),a[a.player].buildStickmanJSON(),a.$apply(),console.log(a[a.player].toJSON())},10),document.addEventListener("keyup",function(b){37==b.keyCode&&(a[a.player].movingLeft=!1),39==b.keyCode&&(a[a.player].movingRight=!1),38==b.keyCode&&(a[a.player].movingTop=!1),40==b.keyCode&&a[a.player].up(30,a)})}]).directive("playground",function(){return{templateNamespace:"svg",templateUrl:"/templates/svg.html",replace:!0}});var Player=function(a,b,c,d,e,f){var g=this;g.SVG=null,g.init=function(a,b,c,d,e,f){g.SVG=a,g.x=c,g.id=f,g.y=d,g.buildStickmanJSON(),g.armx=g.x,g.height=100,g.bodyy2=g.y+g.height},g.drawStickman=function(){console.log(e),g.SVG.drawLine("body",e.body,g.id,e)},g.jump=function(a,b,c){g.initialHeight=g.y;var d=!1,e=!0;g.jumping++,g.jumpInterval=setInterval(function(){g.initialHeight-a<g.y&&!d&&e?g.y--:d||(e=!1,g.y++,g.y==c&&(d=!0)),g.buildStickmanJSON(),b.$apply(),d&&(g.jumping=0,clearInterval(g.jumpInterval))},5)},g.stopJump=function(){return clearInterval(g.jumpInterval),g.initialHeight},g.getY=function(){return g.y},g.getX=function(){return g.x},g.moveLeft=function(){return g.crouched?0:(g.x--,g.x--,void(g.punching&&(g.armx-=2)))},g.moveRight=function(){return g.crouched?0:(g.x++,g.x++,void(g.punching&&(g.armx+=2)))},g.crouch=function(a,b){g.crouched=!0,g.bodyy1+=a,g.buildStickmanJSON(),b.$apply()},g.up=function(a,b){g.crouched=!1,g.bodyy1-=a,g.buildStickmanJSON(),b.$apply()},g.punch=function(a,b,c){var d=!0,e=!1;g.punching=!0,console.log("coucou"),g.punchInterval=setInterval(function(){g.armx-a<g.x&&!e&&d?g.arm+=c:e||(d=!1,g.armx-=c,g.x==g.armx&&(e=!0)),g.buildStickmanJSON(),b.$apply(),e&&(g.attacking=!1,g.punching=!1,clearInterval(g.punchInterval))},5)},g.buildStickmanJSON=function(){g.punching||(g.armx=g.x),g.crouched||(g.bodyy1=g.y),g.body={x1:g.x,y1:g.bodyy1,x2:g.x,y2:g.y+g.height,stroke:"black",strokeWidth:7},g.head={cx:g.x,cy:g.bodyy1,r:10,stroke:"black",strokeWidth:7,fill:"black"},g.arm={x1:g.x,y1:g.y+20,x2:g.armx,y2:g.y+20,stroke:"black",strokeWidth:7},g.leg={x1:g.x,y1:g.y+60,x2:g.x,y2:g.y+60,stroke:"black",strokeWidth:7},g.block={x1:g.x,y1:g.y-g.height,x2:g.x,y2:g.y-g.height,stroke:"blue",strokeWidth:4}},g.init(a,b,c,d,e,f)},SVGLib=function(){var a=this;a.createWorkspace=function(){a.workspace=document.createElementNS("http://www.w3.org/2000/svg","svg")},a.addSVG=function(a){console.log(a)},a.testJSON=function(a){try{JSON.parse(a)}catch(b){return console.log(b),!1}return!0},a.draw=function(b){a.addSVG(b)},a.init=function(b){for(var c=0;c<b.length;c++)b[c]&&1===b[c].nodeType&&(a.targetDiv=b[c]);return a.targetDiv?void a.createWorkspace():(console.log("Error, enter a valid div"),1)},a.createTag=function(a){return document.createElement(a)},a.drawCircle=function(b,c){var d=a.createTag("circle");d.setAttribute("id",b);for(var e in c)d.setAttribute(e,c[e]);a.draw(d)},a.drawLine=function(b,c,d){var e=a.createTag("line");e.setAttribute("id",b+d),e.setAttribute("stroke-linecap","round");for(var f in c)if("number"==typeof c[f]||"string"==typeof c[f])e.setAttribute(f,"{{player"+d+"."+b+"."+f+"}}");else if("object"==typeof c[f]){var g="";for(var h in c[f])g+=h+"("+c[f][h]+") ";e.setAttribute(f,g)}a.draw(e)},a.getPlayerJSON=function(a,b){var c=new XMLHttpRequest;c.open("GET","ressources/"+a+".json",!0),c.onreadystatechange=function(){return 4==c.readyState&&200==c.status?(b.desc={json:c.responseText},b.buildData(),0):void 0},c.send()},a.init(arguments)};angular.module("JSFight").factory("Auth",["$http","API",function(a,b){return{signup:function(c,d){return a.post(b.url+"auth/signup",{username:c,password:d})},login:function(c,d){return a.post(b.url+"auth/login",{username:c,password:d})},logout:function(){return a.get(b.url+"auth/logout")}}}]);